# Telegram
# Create a bot with @BotFather and paste the token here.
# If a value contains spaces, wrap it in quotes (e.g. KEY="some value with spaces").
TELEGRAM_BOT_TOKEN=123456789:REPLACE_ME

# SECURITY (required)
# Put your own numeric ids here (comma-separated). Until you set at least one of these,
# the bot will treat every chat as unauthorized and will NOT execute Codex.
#
# Get your ids by messaging the bot anything; it will reply with chat_id/user_id.
TELEGRAM_ALLOWED_USER_IDS=
TELEGRAM_ALLOWED_CHAT_IDS=

# Admin allow-lists for destructive bot actions (e.g. /job del <id> confirm).
# Comma-separated numeric ids. If empty and BOT_AUTH_ENABLED=0, deletes are denied.
BOT_ADMIN_USER_IDS=
BOT_ADMIN_CHAT_IDS=

# Bot behavior
LOG_LEVEL=INFO
BOT_STRICT_PROXY=0
BOT_TELEGRAM_PARSE_MODE=HTML
BOT_POLL_TIMEOUT_SECONDS=30
BOT_HTTP_TIMEOUT_SECONDS=60
BOT_HTTP_MAX_RETRIES=3
BOT_HTTP_RETRY_INITIAL_SECONDS=1
BOT_HTTP_RETRY_MAX_SECONDS=10
BOT_UNAUTHORIZED_REPLY_COOLDOWN_SECONDS=600
BOT_DRAIN_UPDATES_ON_START=1
BOT_WORKERS=1
# 0 = unbounded. Set a positive number to avoid unbounded memory growth on spam/flood.
BOT_QUEUE_MAXSIZE=0
# Per-chat queue limit. 0 = only one outstanding job at a time (no queueing).
BOT_MAX_QUEUED_PER_CHAT=1
# Send a "still running" message every N seconds while Codex is running (0 = disabled).
BOT_HEARTBEAT_SECONDS=60
# If the final response exceeds this many chars, send as a .txt file instead of many messages (0 = disabled).
BOT_SEND_AS_FILE_THRESHOLD_CHARS=12000
# Max bytes to download from Telegram when users send images (0 = unlimited).
BOT_MAX_DOWNLOAD_BYTES=52428800

# Status HTTP API (optional; localhost-only recommended)
BOT_STATUS_HTTP_ENABLED=0
BOT_STATUS_HTTP_LISTEN=127.0.0.1:8090
BOT_STATUS_CACHE_TTL_SECONDS=2
BOT_STATUS_STREAM_INTERVAL_SECONDS=1.0
BOT_STATUS_HTTP_TOKEN=
BOT_STATUS_HTTP_SNAPSHOT_RPS=2.0
BOT_STATUS_HTTP_SNAPSHOT_BURST=4.0
BOT_STATUS_HTTP_MAX_SSE_PER_IP=2

# GitHub API (optional; used by tools/github_protect_main.py)
GITHUB_TOKEN=

# Auth (optional)
# If enabled, each chat must /login before using Codex. Session expires after TTL of inactivity.
BOT_AUTH_ENABLED=0
BOT_AUTH_SESSION_TTL_SECONDS=43200
BOT_AUTH_USERS_FILE=/home/aponce/codexbot/users.json
BOT_AUTH_PROFILES_FILE=/home/aponce/codexbot/profiles.json

# Audio transcription (voice notes / audio -> text)
# If enabled, voice/audio messages will be downloaded, transcribed via OpenAI, and then processed like normal text.
BOT_TRANSCRIBE_AUDIO=0
# Backend selection:
# - whispercpp: free/local (recommended). Requires ffmpeg + whisper.cpp + a ggml model.
# - openai: paid API (requires OPENAI_API_KEY).
# - auto: try whispercpp first; fall back to OpenAI if configured.
BOT_TRANSCRIBE_BACKEND=auto

# Local (whisper.cpp) settings
BOT_TRANSCRIBE_FFMPEG_BIN=ffmpeg
BOT_TRANSCRIBE_WHISPERCPP_BIN=whisper-cli
BOT_TRANSCRIBE_WHISPERCPP_MODEL_PATH=/home/aponce/codexbot/models/ggml-medium.bin
BOT_TRANSCRIBE_WHISPERCPP_THREADS=8
BOT_TRANSCRIBE_TIMEOUT_SECONDS=300

# OpenAI settings (only needed when backend=openai, or backend=auto and local isn't available)
OPENAI_API_KEY=
OPENAI_API_BASE_URL=https://api.openai.com
BOT_TRANSCRIBE_MODEL=gpt-4o-transcribe
# Optional language hint (e.g. "es"). Leave empty for auto-detect.
BOT_TRANSCRIBE_LANGUAGE=es
# Optional prompt/glossary to improve proper nouns and domain terms.
BOT_TRANSCRIBE_PROMPT=
# Hard cap for audio size to transcribe (bytes). 0 = unlimited.
BOT_TRANSCRIBE_MAX_BYTES=26214400

# Voice replies (text -> Telegram voice note)
# If enabled, the bot can reply with a Telegram voice note (e.g., when the user sends a voice note).
BOT_VOICE_OUT_ENABLED=0
# Backend selection:
# - piper: free/local (recommended). Requires Piper binary + model.
# - edge: free/online (recommended for quality). Requires `edge-tts` installed. Sends TTS text to Microsoft.
# - openai: paid API (requires OPENAI_API_KEY).
# - tone: free fallback (short beep) used when TTS isn't available.
BOT_TTS_BACKEND=none
# Hard cap for how many characters to speak. 0 = never speak (still sends caption text).
BOT_TTS_MAX_CHARS=350
# Optional: pitch shift (semitones). Negative = lower voice (more masculine). 0 = unchanged.
BOT_TTS_VOICE_PITCH_SEMITONES=0
# Optional: additional ffmpeg filters applied to voice notes (after pitch shift).
# Default (if unset): highpass+lowpass+loudnorm for clarity.
BOT_TTS_VOICE_FFMPEG_FILTER=highpass=f=90,lowpass=f=12000,loudnorm=I=-16:TP=-1.5:LRA=11

# Edge TTS settings (only needed when BOT_TTS_BACKEND=edge)
BOT_TTS_EDGE_VOICE=es-MX-JorgeNeural
BOT_TTS_EDGE_RATE=+0%
BOT_TTS_EDGE_PITCH=+0Hz

# Local (Piper) settings
BOT_TTS_PIPER_BIN=/home/aponce/codexbot/bin/piper/piper
BOT_TTS_PIPER_MODEL_PATH=/home/aponce/codexbot/models/piper/es_MX-claude-high.onnx
# Optional (multi-speaker models). Leave empty for default.
BOT_TTS_PIPER_SPEAKER=
# Optional tunables (0 = use Piper defaults)
# Lower noise can sound a bit cleaner; length_scale controls speaking speed.
BOT_TTS_PIPER_NOISE_SCALE=0
BOT_TTS_PIPER_LENGTH_SCALE=0
BOT_TTS_PIPER_NOISE_W=0
BOT_TTS_PIPER_SENTENCE_SILENCE=0

# OpenAI TTS settings (only needed when BOT_TTS_BACKEND=openai)
BOT_TTS_OPENAI_MODEL=tts-1
BOT_TTS_OPENAI_VOICE=alloy
BOT_TTS_OPENAI_RESPONSE_FORMAT=mp3

# Advanced (not recommended)
# Allow users to pass a custom `--sandbox` value via /exec, /review, /codex.
# Even when enabled, values are restricted to: read-only, workspace-write, danger-full-access.
BOT_ALLOW_CUSTOM_SANDBOX=0

# EXTREMELY DANGEROUS
# If enabled, disables bot-side argv validation and treats most /<something> as a direct `codex ...` call.
# Additionally, unknown slash commands like `/ls -la` fall back to `codex exec "ls -la"` instead of showing help.
# This effectively removes the "client limitations" and gives full Codex CLI surface area to the chat.
BOT_UNSAFE_DIRECT_CODEX=0

# Codex
# Point this to a git repo (recommended) or any folder you want Codex to work in.
CODEX_WORKDIR=/home/aponce/codexbot

# "ro" (default) = read-only sandbox. "rw" = workspace-write sandbox. "full" = danger-full-access sandbox (unsafe).
CODEX_DEFAULT_MODE=ro

# If enabled, forces danger-full-access regardless of /ro /rw /full.
CODEX_FORCE_FULL_ACCESS=0

# If enabled, passes `--dangerously-bypass-approvals-and-sandbox` to Codex (no sandbox at all).
# Intended only if the host is externally sandboxed (VM/container). EXTREMELY DANGEROUS.
CODEX_DANGEROUS_BYPASS_SANDBOX=0

# Max seconds per Codex run.
CODEX_TIMEOUT_SECONDS=900

# Default: use your normal Codex config/login (OpenAI Codex model via CLI).
# Set to 1 to use a local OSS provider (Ollama / LM Studio).
CODEX_USE_OSS=0
CODEX_LOCAL_PROVIDER=ollama

# OSS model (only used when CODEX_USE_OSS=1).
# If left empty, codexbot defaults to `qwen2.5-coder:7b`.
CODEX_OSS_MODEL=qwen2.5-coder:7b

# Optional: force an OpenAI model name when CODEX_USE_OSS=0 (otherwise uses ~/.codex/config.toml).
CODEX_OPENAI_MODEL=

# Notify target (Telegram)
# Run /setnotify in the chat you want, or hardcode the chat id here.
TELEGRAM_NOTIFY_CHAT_ID=
TELEGRAM_NOTIFY_ON_START=0

# Orchestrator
BOT_ORCHESTRATOR_ENABLED=1
BOT_ORCHESTRATOR_DB_PATH=./data/jobs.sqlite
BOT_ORCHESTRATOR_DEFAULT_PRIORITY=2
BOT_ORCHESTRATOR_DEFAULT_MAX_COST_WINDOW_USD=8.0
BOT_ORCHESTRATOR_DEFAULT_ROLE=jarvis
BOT_ORCHESTRATOR_WORKERS=3
BOT_ORCH_SESSIONS_ENABLED=1
# Notification policy:
# - minimal (default): only top-level tickets + wrap-ups + errors (subtasks/runbooks ok are silent).
# - verbose: send every job result + extra orchestration messages.
BOT_ORCHESTRATOR_NOTIFY_MODE=minimal
# How often to write "live" stdout/stderr tails into SQLite for /agents,/job,/dashboard.
BOT_ORCHESTRATOR_LIVE_UPDATE_SECONDS=8
BOT_WORKTREE_ROOT=./data/worktrees
BOT_ARTIFACTS_ROOT=./data/artifacts
BOT_ORCHESTRATOR_DAILY_DIGEST_SECONDS=21600
BOT_ORCHESTRATOR_AGENT_PROFILES=./orchestrator/agents.yaml
BOT_RUNBOOKS_ENABLED=1
BOT_RUNBOOKS_PATH=./orchestrator/runbooks.yaml
BOT_SCREENSHOT_ENABLED=0
BOT_SCREENSHOT_ALLOWED_HOSTS=
BOT_TRANSCRIBE_ASYNC=1

# CEO display name (used in prompts/docs)
BOT_CEO_NAME="Alejandro Ponce"

# Security note:
# Keep secrets in .env.local (gitignored), not in codexbot.env.

# Mobile app build + Telegram APK delivery (native Android)
MOBILE_APP_PROJECT_DIR=/home/aponce/OmniCrewApp.android
MOBILE_APP_ARTIFACTS_DIR=/home/aponce/codexbot/data/artifacts/mobile
MOBILE_APP_BUILD_SCRIPT=/home/aponce/codexbot/scripts/build_release_apk.sh
MOBILE_APP_KEYSTORE_PATH=/home/aponce/.config/omnicrew-app/keystore.jks
MOBILE_APP_KEY_ALIAS=omnicrew_release
MOBILE_APP_KEYSTORE_PASS=
MOBILE_APP_KEY_PASS=

